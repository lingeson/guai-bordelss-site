
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GUAI BORDEL'SS 2025 - R√©sultats & Phase finale</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin:0; padding:0;
      background:#f4f4f4;
      color:#333;
    }
    header {
      background:#2c3e50;
      color:#fff;
      text-align:center;
      padding:1rem;
    }
    img.logo {
      max-height:80px;
      vertical-align:middle;
    }
    nav {
      background:#34495e;
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      padding:0.5rem;
    }
    nav button {
      margin:5px;
      padding:10px 20px;
      font-size:16px;
      background:#ecf0f1;
      border:none;
      border-radius:5px;
      cursor:pointer;
      transition:background-color 0.3s;
    }
    nav button:hover, nav button.active {
      background:#bdc3c7;
    }
    .content {
      max-width:1000px;
      margin:auto;
      padding:1rem;
    }
    .section {
      display:none;
    }
    .section.active {
      display:block;
    }
    .sports-buttons, .poule-buttons {
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      margin-bottom:1rem;
    }
    .sport-button, .poule-button {
      margin:5px 10px;
      padding:8px 15px;
      font-size:18px;
      cursor:pointer;
      background:#ecf0f1;
      border:none;
      border-radius:5px;
      transition:background-color 0.3s;
    }
    .sport-button:hover, .poule-button:hover,
    .sport-button.active, .poule-button.active {
      background:#bdc3c7;
    }
    table {
      width:100%;
      border-collapse:collapse;
      background:#fff;
      box-shadow:0 2px 4px rgba(0,0,0,0.1);
    }
    th, td {
      padding:8px;
      border:1px solid #ddd;
      text-align:center;
    }
    th {
      background:#34495e;
      color:#fff;
    }
    .message {
      text-align:center;
      font-style:italic;
      margin-top:1rem;
      color:#666;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>

<header>
  <img src="logo.png" alt="Logo" class="logo" />
  <h1>GUAI BORDEL'SS 2025</h1>
</header>

<nav>
  <button class="nav-btn active" onclick="showSection('accueil')">Accueil</button>
  <button class="nav-btn" onclick="showSection('resultats')">R√©sultats</button>
  <button class="nav-btn" onclick="showSection('phase-finale')">Phase finale</button>
</nav>

<div class="content">

  <!-- Accueil -->
  <section id="accueil" class="section active">
    <h2>Bienvenue !</h2>
    <p>Retrouvez toutes les informations des GUAI BORDEL'SS 2025.</p>
  </section>

  <!-- R√©sultats -->
  <section id="resultats" class="section">
    <h2>R√©sultats des matchs</h2>
    <div class="sports-buttons" id="buttons-resultats"></div>
    <div class="poule-buttons" id="buttons-poules-resultats"></div>
    <div id="container-resultats" class="message">Veuillez choisir un sport et une poule.</div>
  </section>

  <!-- Phase finale -->
  <section id="phase-finale" class="section">
    <h2>Phase finale</h2>
    <div class="sports-buttons" id="buttons-phase-finale"></div>
    <div id="container-phase-finale" class="message">Veuillez choisir un sport.</div>
  </section>

</div>

<script>
  const sports = {
    handball: {
      nom: "Handball",
      emoji: "ü§æ‚Äç‚ôÇÔ∏è",
      urlCSV: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRWrOq4N-KeChvdjO4JaEyMZVm-e3G1PNxbX-gEhC7xMDo1Y2dV6-Ax28BOJ31voFSPHhR_dNHrDzIT/pub?gid=0&single=true&output=csv"
    },
    rugby: {
      nom: "Rugby",
      emoji: "üèâ",
      urlCSV: ": https://docs.google.com/spreadsheets/d/e/2PACX-1vRWrOq4N-KeChvdjO4JaEyMZVm-e3G1PNxbX-gEhC7xMDo1Y2dV6-Ax28BOJ31voFSPHhR_dNHrDzIT/pub?gid=702928165&single=true&output=csv"
    }
  };

  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
  }

  function createSportButtons() {
    const btnsResultats = document.getElementById('buttons-resultats');
    const btnsPhaseFinale = document.getElementById('buttons-phase-finale');
    Object.entries(sports).forEach(([key, sport]) => {
      const btn1 = document.createElement('button');
      btn1.className = 'sport-button';
      btn1.textContent = `${sport.emoji} ${sport.nom}`;
      btn1.onclick = () => showPoules(key, sport.urlCSV);
      btnsResultats.appendChild(btn1);

      const btn2 = document.createElement('button');
      btn2.className = 'sport-button';
      btn2.textContent = `${sport.emoji} ${sport.nom}`;
      btn2.onclick = () => showPhaseFinale(key, sport.urlCSV);
      btnsPhaseFinale.appendChild(btn2);
    });
  }

  function showPoules(sportKey, csvURL) {
    const poules = ['Poule A', 'Poule B'];
    const btns = document.getElementById('buttons-poules-resultats');
    btns.innerHTML = '';
    poules.forEach(poule => {
      const btn = document.createElement('button');
      btn.className = 'poule-button';
      btn.textContent = poule;
      btn.onclick = () => fetchAndDisplayWithClassement(csvURL, poule, 'container-resultats');
      btns.appendChild(btn);
    });
    document.getElementById('container-resultats').innerHTML = "Veuillez choisir une poule.";
  }

  function fetchAndDisplayWithClassement(url, pouleName, containerId) {
    fetch(url)
      .then(resp => resp.text())
      .then(csv => {
        const parsed = Papa.parse(csv.trim(), { skipEmptyLines: true }).data;
        const headers = parsed[0];
        const rows = parsed.slice(1).filter(row => row[headers.indexOf('Type de match')] === pouleName);
        const matchs = rows.map(row => ({
          equipeA: row[headers.indexOf('√âquipe A')],
          equipeB: row[headers.indexOf('√âquipe B')],
          scoreA: parseInt(row[headers.indexOf('Score A')]),
          scoreB: parseInt(row[headers.indexOf('Score B')])
        }));

        // Calcul classement
        const teams = {};
        matchs.forEach(m => {
          [m.equipeA, m.equipeB].forEach(e => {
            if (!teams[e]) teams[e] = { pts: 0, joues: 0, diff: 0, marque: 0 };
          });
          teams[m.equipeA].joues++;
          teams[m.equipeB].joues++;
          teams[m.equipeA].marque += m.scoreA;
          teams[m.equipeB].marque += m.scoreB;
          teams[m.equipeA].diff += m.scoreA - m.scoreB;
          teams[m.equipeB].diff += m.scoreB - m.scoreA;

          if (m.scoreA > m.scoreB) teams[m.equipeA].pts += 3;
          else if (m.scoreA < m.scoreB) teams[m.equipeB].pts += 3;
          else { teams[m.equipeA].pts += 1; teams[m.equipeB].pts += 1; }
        });

        const classement = Object.entries(teams).map(([nom, stats]) => ({ nom, ...stats }));
        classement.sort((a, b) => b.pts - a.pts || b.diff - a.diff || b.marque - a.marque);

        // Affichage
        const container = document.getElementById(containerId);
        container.innerHTML = '';

        // Classement
        const tableClassement = document.createElement('table');
        tableClassement.innerHTML = `
          <thead>
            <tr><th>√âquipe</th><th>Pts</th><th>J</th><th>Diff</th><th>Marqu√©s</th></tr>
          </thead>
          <tbody>
            ${classement.map(e => `
              <tr>
                <td>${e.nom}</td><td>${e.pts}</td><td>${e.joues}</td><td>${e.diff}</td><td>${e.marque}</td>
              </tr>
            `).join('')}
          </tbody>
        `;
        container.appendChild(tableClassement);

        // R√©sultats
        const tableMatchs = document.createElement('table');
        tableMatchs.innerHTML = `
          <thead><tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr></thead>
          <tbody>
            ${rows.map(r => `<tr>${r.map(c => `<td>${c}</td>`).join('')}</tr>`).join('')}
          </tbody>
        `;
        container.appendChild(tableMatchs);
      });
  }

  function showPhaseFinale(sportKey, csvURL) {
    fetch(csvURL)
      .then(resp => resp.text())
      .then(csv => {
        const parsed = Papa.parse(csv.trim(), { skipEmptyLines: true }).data;
        const headers = parsed[0];
        const rows = parsed.slice(1);
        const getByType = type => rows.filter(row => row[headers.indexOf('Type de match')] === type);
        const matchByType = type => getByType(type).map(row => ({
          equipeA: row[headers.indexOf('√âquipe A')],
          equipeB: row[headers.indexOf('√âquipe B')],
          scoreA: parseInt(row[headers.indexOf('Score A')]),
          scoreB: parseInt(row[headers.indexOf('Score B')])
        }));

        const pouleA = getByType("Poule A");
        const pouleB = getByType("Poule B");
        const getClassement = (rows) => {
          const teams = {};
          rows.forEach(r => {
            const A = r[headers.indexOf('√âquipe A')];
            const B = r[headers.indexOf('√âquipe B')];
            const SA = parseInt(r[headers.indexOf('Score A')]);
            const SB = parseInt(r[headers.indexOf('Score B')]);
            [A, B].forEach(e => {
              if (!teams[e]) teams[e] = { pts: 0, diff: 0, marque: 0, joues: 0 };
            });
            teams[A].joues++; teams[B].joues++;
            teams[A].diff += SA - SB;
            teams[B].diff += SB - SA;
            teams[A].marque += SA;
            teams[B].marque += SB;
            if (SA > SB) teams[A].pts += 3;
            else if (SA < SB) teams[B].pts += 3;
            else { teams[A].pts += 1; teams[B].pts += 1; }
          });
          return Object.entries(teams).map(([equipe, stats]) => ({ equipe, ...stats }))
            .sort((a, b) => b.pts - a.pts || b.diff - a.diff || b.marque - a.marque);
        };

        const classementA = getClassement(pouleA);
        const classementB = getClassement(pouleB);

        const DF1 = `${classementA[0].equipe} vs ${classementB[1].equipe}`;
        const DF2 = `${classementB[0].equipe} vs ${classementA[1].equipe}`;

        const finale = getByType("Finale")[0];
        const F = finale
          ? `${finale[headers.indexOf('√âquipe A')]} ${finale[headers.indexOf('Score A')]} - ${finale[headers.indexOf('Score B')]} ${finale[headers.indexOf('√âquipe B')]}`
          : "√Ä venir";

        const container = document.getElementById('container-phase-finale');
        container.innerHTML = `
          <div style="text-align:center; font-size:18px; margin:1rem;">
            <div><strong>Demi-finale 1 :</strong><br>${DF1}</div><br>
            <div><strong>Demi-finale 2 :</strong><br>${DF2}</div><br>
            <div style="margin-top:1rem;font-size:22px;">üèÜ <strong>Finale</strong> üèÜ<br>${F}</div>
          </div>
        `;
      });
  }

  createSportButtons();
</script>


</body>
</html>
