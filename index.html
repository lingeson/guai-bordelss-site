<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GUAI BORDEL'SS 2025</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; color: #333; margin:0; padding:0; }
    header { background:#2c3e50; color:#fff; padding:1rem; text-align:center; }
    nav { display:flex; justify-content:center; background:#34495e; }
    nav button { margin:5px; padding:10px 20px; font-size:16px; background:#ecf0f1; border:none; border-radius:5px; cursor:pointer; }
    nav button:hover, nav button.active { background:#bdc3c7; }
    .content { max-width:900px; margin:auto; padding:1rem; }
    .section { display:none; }
    .section.active { display:block; }
    .filter-buttons { display:flex; justify-content:center; margin-bottom:1rem; flex-wrap:wrap; }
    .filter-button { margin:5px 10px; padding:8px 15px; font-size:18px; cursor:pointer; background:#ecf0f1; border:none; border-radius:5px; transition: background-color 0.3s; }
    .filter-button:hover, .filter-button.active { background:#bdc3c7; }
    table { width:100%; border-collapse:collapse; background:#fff; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
    th, td { padding:8px; border:1px solid #ddd; text-align:center; }
    th { background:#34495e; color:#fff; }
    .message { text-align:center; font-style:italic; margin-top:1rem; color:#666; }
  </style>
</head>
<body>
  <header>
    <h1>GUAI BORDEL'SS 2025</h1>
  </header>

  <nav>
    <button id="btn-resultats" class="active" onclick="showSection('resultats')">R√©sultats</button>
  </nav>

  <div class="content">
    <section id="resultats" class="section active">
      <h2>R√©sultats des matchs</h2>

      <div class="filter-buttons" id="buttons-sports"></div>
      <div class="filter-buttons" id="buttons-type-match"></div>

      <div id="container-resultats" class="message">Veuillez choisir un sport et un type de match.</div>
    </section>
  </div>

  <script>
    const sports = {
      handball: {
        nom: "Handball",
        emoji: "ü§æ‚Äç‚ôÇÔ∏è",
        urlCSV: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQQpiogP-Kxoy3rgyFf1nEZd6GxJ_3mcB7pR6LuBPnEP1Y2ThgIOT6qThTDmgv4uV4O3zzl2ZgAZMlu/pub?output=csv" // remplacer par ton vrai lien CSV
      },
      rugby: {
        nom: "Rugby",
        emoji: "üèâ",
        urlCSV: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRWrOq4N-KeChvdjO4JaEyMZVm-e3G1PNxbX-gEhC7xMDo1Y2dV6-Ax28BOJ31voFSPHhR_dNHrDzIT/pub?gid=702928165&single=true&output=csv" // remplacer par ton vrai lien CSV
      }
      // Ajouter d'autres sports ici
    };

    // Types de match √† filtrer
    const typesMatchs = ["Poule A", "Poule B", "Demi-finale", "Finale"];

    let sportSelectionne = null;
    let typeMatchSelectionne = null;
    let dataCSV = null; // stockera toutes les donn√©es du CSV charg√©

    function showSection(id) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
      document.getElementById('btn-' + id).classList.add('active');
    }

    function parseCSV(csvText) {
      return csvText.trim().split('\n').map(line => {
        // support basique pour les cellules entre guillemets avec virgules
        const regex = /(?:,|\n|^)(?:"([^"]*)"|([^",\n]*))/g;
        const row = [];
        let match;
        let lineText = line;
        // Simple split by comma here (attention aux virgules dans champs, √† am√©liorer si besoin)
        return line.split(',').map(cell => cell.trim());
      });
    }

    async function fetchCSV(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Erreur HTTP ${res.status}`);
      return parseCSV(await res.text());
    }

    // Cr√©e les boutons pour choisir un sport
    function createSportButtons() {
      const container = document.getElementById('buttons-sports');
      container.innerHTML = '';
      Object.entries(sports).forEach(([key, sport]) => {
        const btn = document.createElement('button');
        btn.className = 'filter-button';
        btn.innerText = `${sport.emoji} ${sport.nom}`;
        btn.onclick = () => {
          container.querySelectorAll('button').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          sportSelectionne = key;
          typeMatchSelectionne = null;
          dataCSV = null;
          clearTypeMatchButtons();
          loadDataAndShowTypes(key);
          document.getElementById('container-resultats').innerHTML = 'Veuillez choisir un type de match.';
        };
        container.appendChild(btn);
      });
    }

    function clearTypeMatchButtons() {
      document.getElementById('buttons-type-match').innerHTML = '';
    }

    // Cr√©e les boutons pour choisir le type de match
    function createTypeMatchButtons(types) {
      const container = document.getElementById('buttons-type-match');
      container.innerHTML = '';
      types.forEach(type => {
        const btn = document.createElement('button');
        btn.className = 'filter-button';
        btn.innerText = type;
        btn.onclick = () => {
          container.querySelectorAll('button').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          typeMatchSelectionne = type;
          afficherResultatsFiltrees();
        };
        container.appendChild(btn);
      });
    }

    // Charge le CSV, stocke les donn√©es dans dataCSV puis affiche les boutons types de match disponibles (uniques dans CSV)
    async function loadDataAndShowTypes(sportKey) {
      const url = sports[sportKey].urlCSV;
      try {
        const data = await fetchCSV(url);
        dataCSV = data;

        // Trouver index de la colonne "Type de match" (ignore casse)
        const headers = data[0];
        const idxTypeMatch = headers.findIndex(h => h.toLowerCase() === 'type de match');

        if (idxTypeMatch === -1) {
          document.getElementById('container-resultats').innerHTML = 'Colonne "Type de match" introuvable dans la source.';
          clearTypeMatchButtons();
          return;
        }

        // R√©cup√©rer tous les types uniques dans la colonne "Type de match"
        const uniqueTypes = [...new Set(data.slice(1).map(row => row[idxTypeMatch]))].filter(t => t);

        // Trier types selon ordre d√©fini dans typesMatchs, puis ajouter les autres si besoin
        const sortedTypes = typesMatchs.filter(t => uniqueTypes.includes(t))
                           .concat(uniqueTypes.filter(t => !typesMatchs.includes(t)));

        createTypeMatchButtons(sortedTypes);

      } catch(e) {
        document.getElementById('container-resultats').innerHTML = 'Erreur lors du chargement des donn√©es.';
        console.error(e);
      }
    }

    // Affiche dans le tableau uniquement les lignes filtr√©es selon sportSelectionne et typeMatchSelectionne
    function afficherResultatsFiltrees() {
      const container = document.getElementById('container-resultats');
      if (!dataCSV || !sportSelectionne || !typeMatchSelectionne) {
        container.innerHTML = 'Veuillez choisir un sport et un type de match.';
        return;
      }

      const headers = dataCSV[0];
      const idxTypeMatch = headers.findIndex(h => h.toLowerCase() === 'type de match');

      if (idxTypeMatch === -1) {
        container.innerHTML = 'Colonne "Type de match" introuvable.';
        return;
      }

      // Filtrer lignes par type de match choisi
      const filteredRows = dataCSV.slice(1).filter(row => row[idxTypeMatch] === typeMatchSelectionne);

      if (filteredRows.length === 0) {
        container.innerHTML = `Aucun r√©sultat trouv√© pour "${typeMatchSelectionne}".`;
        return;
      }

      let html = '<table><thead><tr>' + headers.map(h => `<th>${h}</th>`).join('') + '</tr></thead><tbody>';
      html += filteredRows.map(row => '<tr>' + row.map(cell => `<td>${cell}</td>`).join('') + '</tr>').join('');
      html += '</tbody></table>';

      container.innerHTML = html;
    }

    // Initialisation
    createSportButtons();
  </script>
</body>
</html>
