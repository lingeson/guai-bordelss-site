<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GUAI BORDEL'SS 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  </head>
  <body class="bg-gray-100 text-gray-900">
    <header class="bg-blue-700 text-white p-4 text-center text-2xl font-bold">
      GUAI BORDEL'SS 2025
    </header>

    <nav class="flex flex-wrap justify-center gap-4 p-4 bg-blue-100">
      <button class="sport-btn px-4 py-2 bg-blue-500 text-white rounded" data-sport="football">Football</button>
      <button class="sport-btn px-4 py-2 bg-blue-500 text-white rounded" data-sport="basket">Basket</button>
      <button class="sport-btn px-4 py-2 bg-blue-500 text-white rounded" data-sport="volley">Volley</button>
    </nav>

    <main id="content" class="p-4 max-w-4xl mx-auto">
      <p class="text-center text-lg">Choisissez un sport pour voir les résultats.</p>
    </main>

    <script>
      const content = document.getElementById("content");

      const csvUrls = {
        football: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTKEezczf3sOi1Fuh2UeEtpiDyVCy9PNmCXPONlDyVEg1aa_d3YdICmOVHuhV6EdvqZKmufTmvq-2rl/pub?gid=1216694082&single=true&output=csv",
        basket: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTKEezczf3sOi1Fuh2UeEtpiDyVCy9PNmCXPONlDyVEg1aa_d3YdICmOVHuhV6EdvqZKmufTmvq-2rl/pub?gid=1829432646&single=true&output=csv",
        volley: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTKEezczf3sOi1Fuh2UeEtpiDyVCy9PNmCXPONlDyVEg1aa_d3YdICmOVHuhV6EdvqZKmufTmvq-2rl/pub?gid=1819401989&single=true&output=csv",
      };

      document.querySelectorAll(".sport-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const sport = btn.dataset.sport;
          fetchAndDisplayResults(sport);
        });
      });

      function fetchAndDisplayResults(sport) {
        content.innerHTML = `<p class="text-center text-lg">Chargement des résultats pour ${sport}...</p>`;
        const url = csvUrls[sport];

        Papa.parse(url, {
          download: true,
          header: true,
          complete: function (results) {
            const data = results.data.filter(row => row.Equipe1 && row.Equipe2);
            renderResults(sport, data);
          },
        });
      }

      function renderResults(sport, matches) {
        content.innerHTML = `<h2 class="text-xl font-bold mb-4">Résultats - ${sport}</h2>`;

        const table = document.createElement("table");
        table.className = "table-auto w-full text-sm text-left bg-white rounded shadow overflow-hidden";

        const thead = document.createElement("thead");
        thead.innerHTML = `
          <tr class="bg-blue-200">
            <th class="p-2">Equipe 1</th>
            <th class="p-2">Score</th>
            <th class="p-2">Equipe 2</th>
          </tr>
        `;

        const tbody = document.createElement("tbody");

        for (const match of matches) {
          const row = document.createElement("tr");
          row.className = "border-t hover:bg-blue-50";

          const score1 = match.Score1 || "-";
          const score2 = match.Score2 || "-";

          row.innerHTML = `
            <td class="p-2">${match.Equipe1}</td>
            <td class="p-2 text-center">${score1} - ${score2}</td>
            <td class="p-2">${match.Equipe2}</td>
          `;
          tbody.appendChild(row);
        }

        table.appendChild(thead);
        table.appendChild(tbody);
        content.appendChild(table);

        // Générer les phases finales si nécessaire
        if (matches.length >= 4) {
          const finalists = calculateFinalists(matches);
          renderFinalPhases(finalists);
        }
      }

      function calculateFinalists(matches) {
        const scores = {};
        matches.forEach(({ Equipe1, Equipe2, Score1, Score2 }) => {
          const s1 = parseInt(Score1);
          const s2 = parseInt(Score2);
          if (!isNaN(s1) && !isNaN(s2)) {
            scores[Equipe1] = (scores[Equipe1] || 0) + (s1 > s2 ? 3 : s1 === s2 ? 1 : 0);
            scores[Equipe2] = (scores[Equipe2] || 0) + (s2 > s1 ? 3 : s1 === s2 ? 1 : 0);
          }
        });
        return Object.entries(scores)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 4)
          .map(([team]) => team);
      }

      function renderFinalPhases(teams) {
        const bracket = document.createElement("div");
        bracket.className = "mt-8 p-4 bg-gray-200 rounded";
        bracket.innerHTML = `<h3 class="text-lg font-semibold mb-2">Phases Finales</h3>
          <p>Demi-finales :</p>
          <ul class="list-disc ml-5">
            <li>${teams[0]} vs ${teams[3]}</li>
            <li>${teams[1]} vs ${teams[2]}</li>
          </ul>
        `;
        content.appendChild(bracket);
      }
    </script>
  </body>
</html>
