<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Résultats Sports</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f4f4f4;
    }
    header {
      background: #222;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }
    nav {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      background: #444;
    }
    nav button {
      background: #666;
      border: none;
      color: white;
      padding: 10px 15px;
      margin: 5px;
      cursor: pointer;
      border-radius: 5px;
    }
    nav button.active {
      background: #ff9800;
    }
    section {
      padding: 1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 2rem;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    h2 {
      margin-top: 2rem;
    }
    .hidden {
      display: none;
    }
    canvas {
      width: 100% !important;
      max-width: 600px;
      margin: auto;
    }
  </style>
</head>

<body>
  <header>
    <h1>Résultats Sportifs - Tournoi</h1>
  </header>
  <nav id="main-tabs"></nav>
  <section id="content"></section>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const sports = {
      "Handball": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRWrOq4N-KeChvdjO4JaEyMZVm-e3G1PNxbX-gEhC7xMDo1Y2dV6-Ax28BOJ31voFSPHhR_dNHrDzIT/pub?gid=0&single=true&output=csv",
      // Ajoute ici tous les autres sports avec leur URL CSV
    };

    const mainTabs = document.getElementById("main-tabs");
    const content = document.getElementById("content");

    const fetchCSV = async (url) => {
      const res = await fetch(url);
      const text = await res.text();
      return text.trim().split("\n").map(line => line.split(","));
    };

    const computeStandings = (matches) => {
      const teams = {};
      matches.forEach(([jour, heure, terrain, eqA, eqB, scoreA, scoreB, type]) => {
        if (!teams[eqA]) teams[eqA] = { PJ: 0, G: 0, N: 0, P: 0, BP: 0, BC: 0, Pts: 0 };
        if (!teams[eqB]) teams[eqB] = { PJ: 0, G: 0, N: 0, P: 0, BP: 0, BC: 0, Pts: 0 };

        const sA = parseInt(scoreA);
        const sB = parseInt(scoreB);

        if (!isNaN(sA) && !isNaN(sB)) {
          teams[eqA].PJ++;
          teams[eqB].PJ++;
          teams[eqA].BP += sA;
          teams[eqA].BC += sB;
          teams[eqB].BP += sB;
          teams[eqB].BC += sA;

          if (sA > sB) {
            teams[eqA].G++;
            teams[eqA].Pts += 3;
            teams[eqB].P++;
          } else if (sA < sB) {
            teams[eqB].G++;
            teams[eqB].Pts += 3;
            teams[eqA].P++;
          } else {
            teams[eqA].N++;
            teams[eqB].N++;
            teams[eqA].Pts++;
            teams[eqB].Pts++;
          }
        }
      });

      return Object.entries(teams).map(([team, stats]) => ({ team, ...stats }))
        .sort((a, b) => b.Pts - a.Pts || b.BP - b.BC - (a.BP - a.BC));
    };

    const renderTable = (headers, rows) => {
      return `
        <table>
          <thead><tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr></thead>
          <tbody>
            ${rows.map(r => `<tr>${r.map(c => `<td>${c}</td>`).join('')}</tr>`).join('')}
          </tbody>
        </table>
      `;
    };

    const renderPhaseFinale = (a1, b2, b1, a2) => {
      return `
        <h2>Phase Finale</h2>
        <canvas id="phaseChart"></canvas>
        <script>
          new Chart(document.getElementById('phaseChart').getContext('2d'), {
            type: 'bar',
            data: {
              labels: ['Demi 1: ${a1} vs ${b2}', 'Demi 2: ${b1} vs ${a2}'],
              datasets: [{
                label: 'Matchs de Demi-Finale',
                data: [1, 1],
                backgroundColor: ['#42a5f5', '#66bb6a']
              }]
            },
            options: { indexAxis: 'y', plugins: { legend: { display: false } } }
          });
        </script>
      `;
    };

    const loadSport = async (sport, url) => {
      const data = await fetchCSV(url);
      const header = data[0];
      const rows = data.slice(1);
      const pouleA = rows.filter(r => r[7].includes("A"));
      const pouleB = rows.filter(r => r[7].includes("B"));

      const classementA = computeStandings(pouleA);
      const classementB = computeStandings(pouleB);

      const tab = document.createElement("div");
      tab.innerHTML = `
        <h2>${sport} - Poule A</h2>
        ${renderTable(["Equipe", "Pts", "PJ", "G", "N", "P", "BP", "BC"], classementA.map(t => [t.team, t.Pts, t.PJ, t.G, t.N, t.P, t.BP, t.BC]))}
        ${renderTable(header, pouleA)}

        <h2>${sport} - Poule B</h2>
        ${renderTable(["Equipe", "Pts", "PJ", "G", "N", "P", "BP", "BC"], classementB.map(t => [t.team, t.Pts, t.PJ, t.G, t.N, t.P, t.BP, t.BC]))}
        ${renderTable(header, pouleB)}

        ${renderPhaseFinale(classementA[0]?.team || '', classementB[1]?.team || '', classementB[0]?.team || '', classementA[1]?.team || '')}
      `;

      content.innerHTML = '';
      content.appendChild(tab);
    };

    Object.entries(sports).forEach(([sport, url], i) => {
      const btn = document.createElement("button");
      btn.textContent = sport;
      btn.onclick = () => {
        document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        loadSport(sport, url);
      };
      if (i === 0) btn.classList.add("active");
      mainTabs.appendChild(btn);
    });

    loadSport(Object.keys(sports)[0], Object.values(sports)[0]);
  </script>
</body>
</html>
